BEGIN;
CREATE EXTENSION webauthn CASCADE;
NOTICE:  installing required extension "pguecc"
NOTICE:  installing required extension "pgcrypto"
SELECT jsonb_pretty(webauthn.init_credential(
  challenge := '\xf1f49abe5e3dcff7a1f522252f4fb574df415dd087aae156114ac9b51fbf4129'::bytea,
  relying_party_name := 'Localhost'::text,
  relying_party_id := 'localhost'::text,
  user_name := 'test'::text,
  user_id := '\xb3368c7317791c5a98b81428cdf3e35012aa71e6090d04930b390049ead7c282064ee24e9dc7219b6d727cc85aad4dcc0f3134f8e62c6c896a48ac08aac3db1b'::bytea,
  user_display_name := 'test'::text,
  timeout := '2 minutes'::interval,
  challenge_at := '2020-12-13 16:35:00+01'
));
                                                jsonb_pretty                                                 
-------------------------------------------------------------------------------------------------------------
 {                                                                                                          +
     "publicKey": {                                                                                         +
         "rp": {                                                                                            +
             "id": "localhost",                                                                             +
             "name": "Localhost"                                                                            +
         },                                                                                                 +
         "user": {                                                                                          +
             "id": "szaMcxd5HFqYuBQozfPjUBKqceYJDQSTCzkASerXwoIGTuJOncchm21yfMharU3MDzE0-OYsbIlqSKwIqsPbGw",+
             "name": "test",                                                                                +
             "displayName": "test"                                                                          +
         },                                                                                                 +
         "timeout": 120000,                                                                                 +
         "challenge": "8fSavl49z_eh9SIlL0-1dN9BXdCHquFWEUrJtR-_QSk",                                        +
         "attestation": "none",                                                                             +
         "pubKeyCredParams": [                                                                              +
             {                                                                                              +
                 "alg": -7,                                                                                 +
                 "type": "public-key"                                                                       +
             }                                                                                              +
         ],                                                                                                 +
         "authenticatorSelection": {                                                                        +
             "userVerification": "preferred",                                                               +
             "requireResidentKey": false                                                                    +
         }                                                                                                  +
     }                                                                                                      +
 }
(1 row)

SELECT * FROM webauthn.make_credential(
  credential_id := 'ASiVjgqKJgvSawjRv_bjFR6l9uOgpLJ9jaZbGkxytC3vQzq21tlSuPgAnvQF6B0BLK0dujjrqvK3oBktYP8FEdYOZz8LK8PjiyDGXiCrlSYDy58JILDNJIi-n7973HgHhYiDgN_iBCTfX9Y',
  credential_type := 'public-key',
  attestation_object := 'o2NmbXRkbm9uZWdhdHRTdG10oGhhdXRoRGF0YVjvSZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2NFX9SYD63OAAI1vMYKZIsLJfHwVQMAawEolY4KiiYL0msI0b_24xUepfbjoKSyfY2mWxpMcrQt70M6ttbZUrj4AJ70BegdASytHbo466ryt6AZLWD_BRHWDmc_CyvD44sgxl4gq5UmA8ufCSCwzSSIvp-_e9x4B4WIg4Df4gQk31_WpQECAyYgASFYIFYGLzqrkNKDty3WMhTXQzjWxIXZekODNhjBB8MjZHgpIlgg1wRbPHszTjstSPn7dPAqVDmO0krRy8rWpTjJDAeOFVY',
  client_data_json := 'eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoiOGZTYXZsNDl6X2VoOVNJbEwwLTFkTjlCWGRDSHF1RldFVXJKdFItX1FTayIsIm9yaWdpbiI6Imh0dHA6Ly9sb2NhbGhvc3QiLCJjcm9zc09yaWdpbiI6ZmFsc2V9',
  relying_party_id := 'localhost',
  credential_at := '2020-12-13 16:37:01+01'
);
ERROR:  new row for relation "credentials" violates check constraint "credential_before_timeout"
DETAIL:  Failing row contains (\x0128958e0a8a260bd26b08d1bff6e3151ea5f6e3a0a4b27d8da65b1a4c72b4..., \xf1f49abe5e3dcff7a1f522252f4fb574df415dd087aae156114ac9b51fbf41..., public-key, \xa363666d74646e6f6e656761747453746d74a068617574684461746158ef49..., \x49960de5880e8c687434170f6476605b8fe4aeb9a28632c7995cf3ba831d97..., t, t, t, f, 1607768079, \xadce000235bcc60a648b0b25f1f05503, \x56062f3aab90d283b72dd63214d74338d6c485d97a43833618c107c3236478..., \x7b2274797065223a22776562617574686e2e637265617465222c226368616c..., http://localhost, f, \xb3368c7317791c5a98b81428cdf3e35012aa71e6090d04930b390049ead7c2..., Sun Dec 13 07:37:01 2020 PST).
CONTEXT:  SQL function "make_credential" statement 1
ROLLBACK;
